@model  Hands.ViewModels.Models.Search.SearchModel
@{
    ViewBag.Title = "_";
}

<style>
    .popup {
        position: fixed;
        background: #5f5f5f8c;
        width: 100%;
        padding-left: 30%;
        top: 0;
        padding-top: 21%;
        height: 274%;
        z-index: 10000000000000;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0, 0, 0, 0.075);
    }

    .fa {
        display: inline-block;
        font: normal normal normal 14px/1 FontAwesome;
        font-size: inherit;
        text-rendering: auto;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .widget-header {
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        align-items: center;
        padding: 8px 12px;
        color: #080808;
        font-size: 16px;
        display: flex;
    }

    .mvc-grid-filter::before {
        color: #f4516c !important;
    }

    .abc {
        width: 12%;
        text-align: center;
        background: #f0efff !important;
    }

    *::before, *::after {
        box-sizing: border-box;
    }

    .test {
        width: 100%
    }

    .titlehead {
        font-size: 25px;
        color: #676767;
    }

    .filterable {
        background: #f0efff !important;
        color: #74749a !important;
    }

    .btn {
        padding: 4px 14px !important;
    }
</style>
<link href="~/Content/MvcGrid/mvc-grid.css" rel="stylesheet" />
<div id="resultLoadingDiv" hidden class="popup">
    <img src="~/Content/Images/abc.gif" />

</div>
<div id="PrjDiv">
    <div class="row">
        <div class="col-lg-12">
            <div class="">


                @using (Html.BeginForm(Model.ViewName, Model.ControllerName, FormMethod.Get, new {id = "SubmitForm"}))
                {
                
                <div class="row m-portlet" style="margin-top: 28px; margin: 15px; margin-top: 28px; margin: 15px; padding: 9px 0px 15px 0px; border-radius: 1px;">


                    @{
        var regionSelectListItems = Model.Regions.Where(x=>x.IsActive).Select(r => new SelectListItem { Text = r.RegionName, Value = r.RegionsId.ToString() }).ToList();
                    }
                    <div class="col-md-4">
                        @Html.Label("District", new { @class = "control-label col-md-4" })
                        <div class="col-md-12">
                            @Html.DropDownListFor(f => f.RegionId, regionSelectListItems, "Select", new { @class = "form-control" })

                        </div>
                    </div>
                    <div class="col-md-4">
                        @Html.Label("Taluka", new { @class = "control-label col-md-4" })
                        <div class="col-md-12">
                            @Html.DropDownListFor(f => f.TaluqaId, new SelectList(string.Empty, "Value", "Text"), "Select", new { @class = "form-control" })

                        </div>
                    </div>
                    <div class="col-md-4">
                        @Html.Label("Union Council", new { @class = "control-label col-md-7" })
                        <div class="col-md-12">
                            @Html.DropDownListFor(f => f.UnionCouncilId, new SelectList(string.Empty, "Value", "Text"), "Select", new { @class = "form-control" })
                        </div>

                    </div>

                    <div class="col-md-2" style="margin: 16px">
                        <input type="submit" id="submit" value="Search" class="btn btn-primary top-button test" />
                    </div>
                    <div class="col-md-2" style="margin: 16px -40px;">

                        @Html.ActionLink("Reset", Model.ViewName, Model.ControllerName, new { @class = "btn btn-primary top-button test" })
                    </div>
                    <div class="col-md-2"  style="margin: 16px 16px;">
                        @Html.ActionLink("Export CSV", "ExportIndex", Model.ControllerName, ViewContext.HttpContext.Request.QueryString, new { @class = "btn btn-primary top-button test" })
                    </div>
                </div>


                    <div class="row" style="margin-top: 20px">
                    </div>
                }

            </div>
        </div>
        </div>
</div>

<script type="text/javascript">

    function ShowProcessingMsg() {

        $('#resultLoadingDiv').removeAttr('hidden');

    }
    function HideProcessingMsg() {

        $('#resultLoadingDiv').attr('hidden', '');
    }
    function success() {
        swal("Successful!", "Your record has been deleted successful!", "success");
    }
</script>


<script type="text/javascript">
    $(document).ready(function () {
        
        var district = '@Model.RegionId';
        var taluqa = '@Model.TaluqaId';
        var union = '@Model.UnionCouncilId';
        getTaluqa(district, taluqa);
        GetUniqueElementId(taluqa, union);


    });



    // End datpicker
 

        $("#RegionId").change(function() {

            var data = $("#RegionId").val();
            $("#TaluqaId").empty();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetStates")', // we are calling json method

                dataType: 'json',

                data: { RegionId: $("#RegionId").val(), TaluqaId:0 },
                // here we are get value of selected country and passing same value as inputto json method GetStates.


                success: function(Taluqa) {
                    // states contains the JSON formatted list
                    // of states passed from the controller
                    var items = '<option>Select</option>';
                    $.each(Taluqa,
                        function(i, Taluqa) {
                            items += "<option value='" + Taluqa.Value + "'>" + Taluqa.Text + "</option>";
                            //$("#TaluqaId").append('<option value="' + Taluqa.Value + '">' +
                            //    Taluqa.Text + '</option>');
                            // here we are adding option for States

                        });
                    $('#TaluqaId').html(items);
                },
                error: function(ex) {

                    var items = '<option>Select</option>';
                    $('#TaluqaId').html(items);
                    $('#UnionCouncilId').html(items);
                }
            });
            return false;
        });


        $("#TaluqaId").change(function() {
            var value = $("#TaluqaId").val();
            if (value != "Select") {
                $("#UnionCouncilId").empty();
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetUnions")', // we are calling json method

                    dataType: 'json',

                    data: { TaluqaId: value, UnionCouncilId: 0 },
                    // here we are get value of selected country and passing same value as inputto json method GetStates.


                    success: function(UnionCounil) {
                        // states contains the JSON formatted list
                        // of states passed from the controller
                        var items = '<option>Select</option>';
                        $.each(UnionCounil,
                            function(i, UnionCounil) {

                                items += "<option value='" + UnionCounil.Value + "'>" + UnionCounil.Text + "</option>";
                                //$("#TaluqaId").append('<option value="' + Taluqa.Value + '">' +
                                //    Taluqa.Text + '</option>');
                                // here we are adding option for States

                            });
                        $('#UnionCouncilId').html(items);
                    },
                    error: function(ex) {

                        var items = '<option>Select</option>';
                        $('#UnionCouncilId').html(items);
                    }
                });
                return false;
            } else {
                var items = '<option>Select</option>';
                $('#UnionCouncilId').html(items);
            }

    });

    /////////// new

      function getTaluqa(data, taluqa) {


        $("#TaluqaId").empty();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetStates")', // we are calling json method

            dataType: 'json',

            data: { regionId: data, TaluqaId:taluqa },
            // here we are get value of selected country and passing same value as inputto json method GetStates.


            success: function(Taluqa) {

                // states contains the JSON formatted list
                // of states passed from the controller
                var items = '<option>Select</option>';
                var selectedValue;
                $.each(Taluqa,
                    function(i, Taluqa) {
                        if (Taluqa.Selected) {
                            selectedValue = Taluqa.Value;
                        }

                        var optionHtml = "<option {selected} value='{value}'>{text}</option>";
                        optionHtml = optionHtml.replace('{value}', Taluqa.Value);
                        optionHtml = optionHtml.replace('{text}', Taluqa.Text);
                        optionHtml = optionHtml.replace('{selected}', (Taluqa.Selected == true ? "selected='selected'" : ""));

                        items += optionHtml;

                        //$("#TaluqaId").append('<option value="' + Taluqa.Value + '">' +
                        //    Taluqa.Text + '</option>');
                        // here we are adding option for States

                    });
                $('#TaluqaId').html(items);
                $('#TaluqaId').val(selectedValue);
            },
            error: function(ex) {
                var items = '<option>Select</option>';
                $('#TaluqaId').html(items);
                $('#UnionCouncilId').html(items);
            }
        });
        return false;
    }

    function GetUniqueElementId(data , union)
    {

        var value = $("#TaluqaId").val();
        if (value != "Select") {
            $("#UnionCouncilId").empty();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetUnions")', // we are calling json method

                dataType: 'json',

                data: { taluqaId: data, UnionCouncilId: union},
                // here we are get value of selected country and passing same value as inputto json method GetStates.


                success: function(UnionCounil) {

                    // states contains the JSON formatted list
                    // of states passed from the controller
                    var items = '<option>Select</option>';
                    var selectedValue;
                    $.each(UnionCounil,
                        function(i, UnionCounil) {
                            if (UnionCounil.Selected) {
                                selectedValue = UnionCounil.Value;
                            }
                            var optionHtml = "<option {selected} value='{value}'>{text}</option>";
                            optionHtml = optionHtml.replace('{value}', UnionCounil.Value);
                            optionHtml = optionHtml.replace('{text}', UnionCounil.Text);
                            optionHtml = optionHtml.replace('{selected}', (UnionCounil.Selected == true ? "selected='selected'" : ""));

                            items += optionHtml;
                            //items += "<option selected='" + UnionCounil.Selected +"' value='" + UnionCounil.Value + "'>" + UnionCounil.Text + "</option>";
                            //$("#TaluqaId").append('<option value="' + Taluqa.Value + '">' +
                            //    Taluqa.Text + '</option>');
                            // here we are adding option for States

                        });

                    $('#UnionCouncilId').html(items);
                    $('#UnionCouncilId').val(selectedValue);
                },
                error: function(ex) {


                    var items = '<option>Select</option>';
                    $('#UnionCouncilId').html(items);
                }
            });
            return false;
        } else {
            var items = '<option>Select</option>';
            $('#UnionCouncilId').html(items);
        }

    }

    
</script>
